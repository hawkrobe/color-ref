<!DOCTYPE html>
<html>
    <head>
        <title>Word-color association task</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
        <script src="munsell.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <style>
        button {
          border: none;
          padding: 32px 32px;
          display: inline-block;
          font-size: 16px;
          transition-duration: 0.6s;
        }
        span {
          color: red;
        }
        </style>
    </head>
    <body>
    </body>
    <script>

    //--------------------------------------------------------------------------
    // START EXPERIMENT
    //--------------------------------------------------------------------------

    // for(let i=0; i < munsell.length; i++){
    //   console.log(munsell[i].rgb);
    // };

    var timeline = [];


    var welcome = {
        type: 'html-keyboard-response',
        stimulus: 'Welcome to the experiment. <strong>Press any key to begin</strong>'
    };

    timeline.push(welcome);

    //--------------------------------------------------------------------------
    // COLORBLINDESS TRIALS
    //--------------------------------------------------------------------------

    /* define instructions trial */
    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>To begin with, you will be shown a series of images intended to test your color vision.</p>" +
      "<p>For each image, press the key of the number you see in the image. <br>If you are unsure or do not see anything, press the enter key.</p>" +
      "<p>Please ensure that you are taking this experiment on a desktop or laptop computer <br>" +
      "and that your screen is set to its default brightness and color temperature (e.g. turn off flux).</p>" +
      "<p><strong>Press any key to begin.</strong></p>"
    };

    timeline.push(instructions);

    // all single-digit vanishing plates from ishihara colorblindness test
    var ishiharaPlates = ['Plate2.gif', 'Plate4.gif', 'Plate5.gif'];

    for(let i=0; i < ishiharaPlates.length;i++){
      let str = './ishihara-vanishing-plates/' + ishiharaPlates[i];

      var colorblindness_trial = {
        type: 'image-keyboard-response',
        stimulus: str,
        choices: [13, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57],
        prompt: "<p>Press the key of the number you see. If you are unsure or do not see anything, press the enter key.</p>"
      };
      timeline.push(colorblindness_trial);
    }


    //--------------------------------------------------------------------------
    // NORMING TASK TRIALS
    //--------------------------------------------------------------------------

    $( "button" ).hover(
      function() {
        $( this ).append( $( "<span> ***</span>" ) );
      }, function() {
        $( this ).find( "span" ).last().remove();
      }
    );

    $( "button.fade" ).hover(function() {
      $( this ).fadeOut( 100 );
      $( this ).fadeIn( 500 );
    });

    /* define instructions trial for target words */
    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, you will be given a word " +
          "and a Munsell color space.</p><p>Select the color in the color space that " +
          "you most closely associate with this word.</p>" +
          "<p>Please ensure that you are taking this experiment on a desktop or laptop computer <br>" +
          "and that your screen is set to its default brightness and color temperature (e.g. turn off flux).</p>" +
          "<p><strong>Press any key to begin.</strong></p>"
    };

    timeline.push(instructions);

    // text of buttons = not needed
    var strings = Array(munsell.length).fill('');
    // target words
    var targets = ['berry', 'happy', 'tree', 'sky', 'sad', 'love', 'potato', 'squid', 'near', 'orange', 'safe'];

    // practice words (i.e. color words)
    var practice = ['red', 'orange', 'yellow', 'green', 'blue', 'purple', 'pink'];

    var buttons = new Array(munsell.length);
    for(let i=0; i < munsell.length;i++){
      // if this is the beginning of a row
      if (i%8==0) {
        str = '<section><div><button style=\"background-color:rgb' + munsell[i].rgb + '\"></button>';
      }
      // if this is the last color in a row
      else if ((i+1)%8==0) {
        str = '<button style=\"background-color:rgb' + munsell[i].rgb + '\"></button>'

      } else {
        str = '<button style=\"background-color:rgb' + munsell[i].rgb + '\"></button>';
      }

      //str = '<button class="fade" style="background-color:rgb' + munsell[i].rgb + '"></button>';
      buttons[i] = str;
    }
    console.log(buttons);

    // TESTING
    // var trial = {
    //   type: 'html-button-response',
    //   stimulus: '<p>Word</p>',
    //   choices: ['', '', ''],
    //   margin_horizontal: '0px',
    //   button_html: ['<button1></button1>', '<button2></button2>', '<button3></button3>']
    // };

    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>The next few practice trials will allow you to get comfortable with the system before the experiment begins.</p>" +
          "<p><strong>Press any key to begin the practice trials.</strong></p>"
    };

    timeline.push(instructions);

    // PRACTICE WORD TRIALS
    for(let i=0; i < practice.length;i++){
      var trial = {
        type: 'html-button-response',
        stimulus: practice[i],
        choices: strings,
        margin_horizontal: '0px',
        prompt: '<p><font size="3">Select the color you most closely associate with the word.</font></p>',
        post_trial_gap: 500,
        button_html: buttons
      };

      timeline.push(trial);
    }

    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>You have completed the practice trials.</p>" +
          "<p><strong>Press any key to begin the experiment.</strong></p>"
    };

    timeline.push(instructions);


    // TARGET WORD TRIALS
    for(let i=0; i < targets.length;i++){
      var trial = {
        type: 'html-button-response',
        stimulus: targets[i],
        choices: strings,
        margin_horizontal: '0px',
        prompt: '<p><font size="3">Select the color you most closely associate with the word.</font></p>',
        post_trial_gap: 500,
        button_html: buttons
      };

      timeline.push(trial);
    }


    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      /* execute displayData function when the experiment ends by using the
      on_finish callback function. this function will automatically execute once
      all the trials in the experiement are finished */
      on_finish: function() {
        jsPsych.data.displayData();
      }
    })

    </script>

</html>
